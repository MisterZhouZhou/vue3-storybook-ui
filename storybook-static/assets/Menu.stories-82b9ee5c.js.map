{"version":3,"file":"Menu.stories-82b9ee5c.js","sources":["../../src/components/Menu/types.ts","../../src/components/Menu/index.tsx","../../src/components/Menu/menuItem.tsx","../../src/components/Menu/subMenu.tsx"],"sourcesContent":["import { PropType } from 'vue';\n\n\nconst MenuKey = 'menuKey'\n\ntype SelectFunc = (selectedIndex: string) => void\ntype MenuMode = 'horizontal' | 'vertical'\n\nconst MenuProps = () => ({\n  defaultIndex: {\n    type: String,\n    default: '0'\n  },\n  mode: {\n    type: String as PropType<MenuMode>,\n    default: 'horizontal'\n  },\n  onSelect: Function as PropType<SelectFunc>\n})\n\nconst MenuItemProps = () => ({\n  index: {\n    type: String,\n    required: true\n  },\n  disabled: {\n    type: Boolean,\n    default: false\n  },\n  activeIndex: String,\n  onSelect: Function as PropType<SelectFunc>\n})\n\nconst SubMenuProps = () => ({\n  index: String,\n  title: String,\n  mode: {\n    type: String as PropType<MenuMode>,\n    default: 'horizontal'\n  },\n  activeIndex: String,\n  onSelect: Function as PropType<SelectFunc>\n})\n\nexport interface ItemType {\n  [key: string]: any;\n}\n\n\nexport interface MenuContext {\n  index: string;\n  onSelect?: SelectFunc;\n  mode?: MenuMode\n}\n\n\n\n\nexport { SubMenuProps, MenuKey, MenuProps, MenuItemProps }","import classNames from 'classnames';\nimport {\n  cloneVNode,\n  defineComponent,\n  ref,\n  watch,\n} from 'vue';\nimport { ItemType, MenuProps } from './types';\nimport './index.scss';\n\nexport default defineComponent({\n  name: 'MMenu',\n  props: MenuProps(),\n  emits: ['onSelect'],\n  setup(props, { emit, slots, attrs }) {\n    const currentActive = ref<string>(props.defaultIndex);\n\n    watch(() => props.defaultIndex, (newVal) => {\n      currentActive.value = newVal;\n    })\n\n    const handleClick = (index: string) => {\n      if (index.indexOf('-') !== undefined) {\n        const indexTmp = index.split('-')[0];\n        currentActive.value = indexTmp;\n      } else {\n        currentActive.value = index;\n      }\n      emit('onSelect', index);\n    };\n\n    return () => {\n      const { mode } = props;\n      const renderChildren = () => {\n        return slots.default!().map((item, index) => {\n          if (\n            (item.type as ItemType).name === 'MMenuItem' ||\n            (item.type as ItemType).name === 'MSubMenu'\n          ) {\n            // 拷贝一个vue节点\n            return cloneVNode(item, { index: index.toString(), onSelect: handleClick, activeIndex: currentActive.value, mode });\n          } else {\n            console.error(\"Menu's child must be MenuItem or MSubMenu\");\n          }\n        });\n      };\n\n      const classes = classNames('m-menu', {\n        [`menu-${mode}`]: mode\n      });\n\n      return (\n        <ul {...attrs} class={classes}>\n          {renderChildren()}\n        </ul>\n      );\n    };\n  },\n});\n","import classNames from 'classnames';\nimport { defineComponent } from 'vue';\nimport { MenuItemProps } from './types';\n\nconst MenuItem = defineComponent({\n  name: 'MMenuItem',\n  props: MenuItemProps(),\n  setup(props, { slots, attrs }) {\n    return () => {\n      const { index, disabled, activeIndex, onSelect } = props;\n      \n      // item click\n      const handleClick = () => {\n        if (onSelect && !disabled) {\n          onSelect(index!)\n        }\n      };\n\n      const classes = classNames('menu-item', {\n        'is-disabled': disabled,\n        'is-active': activeIndex === index,\n      });\n      return (\n        <li {...attrs} class={classes} onClick={handleClick}>\n          {slots.default!()}\n        </li>\n      );\n    };\n  },\n});\n\nMenuItem.playName = 'MenuItem';\n\nexport default MenuItem;\n","import classNames from 'classnames'\nimport {\n\tcloneVNode,\n\tdefineComponent,\n\treactive,\n\tref,\n  watch,\n} from 'vue'\nimport { ItemType, SubMenuProps } from './types'\n\nexport default defineComponent({\n\tname: 'MSubMenu',\n\tprops: SubMenuProps(),\n\tsetup(props, { attrs, slots }) {\n\t\tconst menuOpen = ref(false)\n\t\tconst subClass = reactive({\n\t\t\t'm-submenu': true,\n\t\t\t'menu-opened': props.mode === 'vertical' ? !menuOpen.value : menuOpen.value,\n\t\t})\n    const currentActive = ref<string>()\n\n    watch(() => props.activeIndex, () => {\n      // 菜单被选中，取消子菜单的选中\n      if (props.activeIndex !== props.index) {\n        currentActive.value = \"\"\n      }\n    })\n\n    // 点击事件\n\t\tconst handleClick = (e: MouseEvent) => {\n\t\t\te.preventDefault()\n\t\t\t// subClass['menu-opened'] = !subClass['menu-opened']\n      if (props.onSelect) {\n        props.onSelect(props.index!)\n      }\n\t\t}\n\n\t\tlet timer: any\n\t\tconst handleMouse = (e: MouseEvent, toggle: boolean) => {\n\t\t\tclearTimeout(timer)\n\t\t\te.preventDefault()\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tsubClass['menu-opened'] = toggle\n\t\t\t}, 100)\n\t\t}\n    // 标题点击\n\t\tconst clickEvents = props.mode === 'vertical' ? {\n      onClick: handleClick,\n    } : {}\n\n    // 鼠标移入、移出\n\t\tconst hoverEvents = props.mode !== 'vertical' ? {\n      onMouseenter: (e: MouseEvent) => {\n        handleMouse(e, true)\n      },\n      onMouseleave: (e: MouseEvent) => {\n        handleMouse(e, false)\n      },\n    } : {}\n\n    const menuHandleClick = (index: string) => {\n      currentActive.value = index\n      if (props.onSelect) {\n        props.onSelect(index)\n      }\n    };\n\n    // 下拉项\n    const renderChildren = () => {\n      const items = slots.default!().map((item, index) => {\n        if ((item.type as ItemType).name === 'MMenuItem') {\n          return cloneVNode(item, {\n            index: `${props.index}-${index.toString()}`,\n            activeIndex: currentActive.value,\n            onSelect: menuHandleClick\n          })\n        } else {\n          console.error(\"MSubMenu's child must be a MMenuItem\")\n        }\n      })\n      return <ul class={subClass}>{items}</ul>\n    }\n\n\t\treturn () => {\n\t\t\tconst { index, title, activeIndex } = props\n\t\t\tconst classes = classNames('menu-item submenu-item', {\n\t\t\t\t'is-active': activeIndex === index,\n\t\t\t})\n\n\t\t\treturn (\n\t\t\t\t<li {...attrs} key={index} class={classes} {...hoverEvents}>\n\t\t\t\t\t<div class='submenu-title' {...clickEvents} onClick={handleClick}>\n\t\t\t\t\t\t{title}\n\t\t\t\t\t</div>\n\t\t\t\t\t{renderChildren()}\n\t\t\t\t</li>\n\t\t\t)\n\t\t}\n\t},\n})\n"],"names":["MenuProps","MenuItemProps","SubMenuProps","defineComponent","name","props","emits","setup","emit","slots","attrs","currentActive","ref","defaultIndex","watch","newVal","value","handleClick","index","indexOf","undefined","indexTmp","split","mode","renderChildren","default","map","item","type","cloneVNode","toString","onSelect","activeIndex","console","error","classes","classNames","_createVNode","_mergeProps","MenuItem","disabled","playName","menuOpen","subClass","reactive","e","preventDefault","timer","handleMouse","toggle","clearTimeout","setTimeout","clickEvents","onClick","hoverEvents","onMouseenter","onMouseleave","menuHandleClick","items","title"],"mappings":"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"}